<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/assets/form.js"></script>
    <style>
        .matcher,.compound{
            padding-left: 0.5cm;

        }
        .simple-matcher, .compound-matcher{
            margin-left: 0.25cm;
            padding: 0.1cm;

        }
        .simple-matcher{
            border-left: 1px solid black;
        }
        .compound-matcher{
            border-left: 1px solid purple;

        }
        #matcherthing > .compound-matcher{
            grid-row-end: span 3;
        }
//        #matcherthing > .simple-matcher,.compound-matcher {
//            width:25%;
//        }
        #matcherthing {
            display:grid;
            grid:auto-flow dense/1fr 1fr 1fr;
            grid-auto-rows: auto;
            width:100%;
        }


    </style>
</head>
<body>
<!--
TODO Add more configurability
TODO Add css to make it look better
TODO style customization (Requires an improved chart API)
-->
<object id="svg">
</object>
<form>
    <div id="matcherthing"
         style="">
        <div>
            <button type="button" onclick="preview()">Preview</button>
            <span>Show titles: <input type="checkbox" id="show_titles"/></span><br/>
            <span>Chart Width:<input id="width" type="number" value="20"></span><br/>
            <span>Chart Height: <input id="height" type="number" value="10"></span><br/>
            <span>Chart count: <input id="chart_count" type="number" value="1"></span><br/>
            <span>Refresh Interval: <input id="refresh" type="number" value="35"></span>
        </div>
    </div>
</form>
<script type="text/javascript">
    let f = document.getElementById("matcherthing");
    json_to_form(f,%%REPLACE%%);
    const geturl=function() {
        let id=0;
        return function(data){
        let  st = document.querySelector("#show_titles").value?'true':'false';
        return '/svg?patterns='+data+"&show_titles="+st
                    +"&width="+document.querySelector("#width").value+"&height="+document.querySelector("#height").value+"&max_charts="
                    + document.querySelector("#chart_count").value+"&id="+(id++);
    }}();
    var timing=undefined;
    function preview(){

        let data = encodeURIComponent(JSON.stringify(from_form(f)));
//        window.open('/?patterns='+data+"&show_titles="+document.querySelector("#show_titles").value
//                    +"&width="+document.querySelector("#width").value+"&height="+document.querySelector("#height").value,'_blank').focus();
        document.querySelector('#svg').setAttribute('data',"");
        document.querySelector('#svg').setAttribute('data',geturl(data));
        if(timing===undefined){
            let time = document.getElementById("refresh").value;
            setTimeout(function(){timing=undefined;preview()},time * 1000);
        }else{
            console.log("No need to schedule event :)");
        }
    }


</script>
</body>
</html>